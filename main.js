(()=>{"use strict";function e(e){return{game:e,playRandom:e=>{let t=Math.floor(10*Math.random()),i=Math.floor(10*Math.random());return console.log(t,i),!!e.gameboard[t][i].isAvailable&&(e.receiveAttack(t,i),!0)}}}function t(){let e=[...Array(10)].map((e=>Array(10)));for(let t=0;t<10;t++)for(let i=0;i<10;i++)e[t][i]={ship:"undefined",isAvailable:!0};return e}function i(){return{allShips:[],gameboard:t(),missed:[],isAllPlaced:!1,defenseTurn:!1,placeShip(e,t,i,a){if(0==a)return;if(!function(e,t,i,a,r){if("vertical"==a){i+r>10&&(i=10-r);for(let a=i;a<i+r;a++){if(a+1<=9&&"undefined"!=e[t][a+1].ship)return!1;if(a-1>=0&&"undefined"!=e[t][a-1].ship)return!1;if(t-1>=0&&"undefined"!=e[t-1][a].ship)return!1;if(t+1<=9&&"undefined"!=e[t+1][a].ship)return!1}}else if("horizontal"==a){t+r>10&&(t=10-r);for(let a=t;a<t+r;a++){if(a+1<=9&&"undefined"!=e[a+1][i].ship)return!1;if(a-1>=0&&"undefined"!=e[a-1][i].ship)return!1;if(i-1>=0&&"undefined"!=e[a][i-1].ship)return!1;if(i+1<=9&&"undefined"!=e[a][i+1].ship)return!1}}return!0}(this.gameboard,e,t,i,a))return!1;let r={length:n=a,hit:0,isSunk:()=>n==hit};var n;if(this.allShips.push(r),"vertical"==i){t+a>10&&(t=10-a);for(let i=t;i<t+a;i++)this.gameboard[e][i].ship=r;return!0}if("horizontal"==i){e+a>10&&(e=10-a);for(let i=e;i<e+a;i++)this.gameboard[i][t].ship=r;return!0}},receiveAttack(e,t){return!!this.gameboard[e][t].isAvailable&&("undefined"!=this.gameboard[e][t].ship?this.gameboard[e][t].hit++:this.missed.includes([e,t])||this.missed.push([e,t]),this.gameboard[e][t].isAvailable=!1,!0)},isAllSunk(){return this.allShips.forEach((e=>{if(!e.isSunk())return!1})),!0},startPlacement(){const e=document.querySelector(".switch > input");let t=document.querySelectorAll(".gameboard > .water"),i=5;t.forEach((t=>{t.onclick=()=>{let a=e.checked?"vertical":"horizontal",r=[...t.parentElement.children].indexOf(t),n=Math.floor(r/10),l=r%10;this.placeShip(n,l,a,i)&&i--,i||(this.isAllPlaced=!0),this.renderGameboard()}}))},makeAttackable(){document.querySelectorAll(".computer-board > .water").forEach((e=>{let t=[...e.parentElement.children].indexOf(e),i=Math.floor(t/10),a=t%10;e.onclick=()=>{this.receiveAttack(i,a)&&(this.defenseTurn=!1,this.renderGameboard())}}))},renderGameboard(){document.querySelectorAll(".gameboard > .water").forEach((e=>{let t=[...e.parentElement.children].indexOf(e),i=Math.floor(t/10),a=t%10;e.classList="",e.classList.add("water"),"undefined"==this.gameboard[i][a].ship&&this.gameboard[i][a].isAvailable?e.classList.add("free-water"):"undefined"!=this.gameboard[i][a].ship||this.gameboard[i][a].isAvailable?this.gameboard[i][a].isAvailable?e.classList.add("ship"):this.gameboard[i][a].isAvailable||e.classList.add("ship-hit"):e.classList.add("water-hit")}))}}}e(i());const a=e(i());a.game.startPlacement(),e(i()).game.makeAttackable(),document.querySelector(".start").onclick=()=>{a.game.isAllPlaced&&(document.querySelector(".modal-container").style.display="none")}})();