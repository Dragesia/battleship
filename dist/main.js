(()=>{"use strict";function e(){let e=[...Array(10)].map((e=>Array(10)));for(let a=0;a<10;a++)for(let t=0;t<10;t++)e[a][t]={ship:"undefined",isAvailable:!0};return e}function a(e,a,t,r,i){if("vertical"==r){t+i>10&&(t=10-i);for(let r=t;r<t+i;r++){if(r+1<=9&&"undefined"!=e[a][r+1].ship)return!1;if(r-1>=0&&"undefined"!=e[a][r-1].ship)return!1;if(a-1>=0&&"undefined"!=e[a-1][r].ship)return!1;if(a+1<=9&&"undefined"!=e[a+1][r].ship)return!1}}else if("horizontal"==r){a+i>10&&(a=10-i);for(let r=a;r<a+i;r++){if(r+1<=9&&"undefined"!=e[r+1][t].ship)return!1;if(r-1>=0&&"undefined"!=e[r-1][t].ship)return!1;if(t-1>=0&&"undefined"!=e[r][t-1].ship)return!1;if(t+1<=9&&"undefined"!=e[r][t+1].ship)return!1}}return!0}function t(){return{allShips:[],gameboard:e(),missed:[],isAllPlaced:!1,placeShip(e,t,r,i){if(0==i)return;if(!a(this.gameboard,e,t,r,i))return!1;let l=function(e){return{shipLength:e,hit:0,isSunk(){return this.shipLength==this.hit}}}(i);if(this.allShips.push(l),"vertical"==r){t+i>10&&(t=10-i);for(let a=t;a<t+i;a++)this.gameboard[e][a].ship=l;return!0}if("horizontal"==r){e+i>10&&(e=10-i);for(let a=e;a<e+i;a++)this.gameboard[a][t].ship=l;return!0}},receiveAttack(e,a){return!!this.gameboard[e][a].isAvailable&&("undefined"!=this.gameboard[e][a].ship?this.gameboard[e][a].ship.hit++:this.missed.includes([e,a])||this.missed.push([e,a]),this.gameboard[e][a].isAvailable=!1,!0)},isAllSunk(){for(let e=0;e<this.allShips.length;e++)if(!this.allShips[e].isSunk())return!1;return!0},startPlacement(){const e=document.querySelector(".switch > input");let a=document.querySelectorAll(".gameboard > .water"),t=5;a.forEach((a=>{a.onclick=()=>{let r=e.checked?"vertical":"horizontal",i=[...a.parentElement.children].indexOf(a),l=Math.floor(i/10),o=i%10;this.placeShip(l,o,r,t)&&t--,t||(this.isAllPlaced=!0),this.renderGameboard("user")}}))},makeAttackable(){document.querySelectorAll(".computer-board > .water").forEach((e=>{let a=[...e.parentElement.children].indexOf(e),t=Math.floor(a/10),r=a%10;e.onclick=()=>{this.receiveAttack(t,r)&&this.renderGameboard("computer")}}))},renderGameboard(e){"user"==e?document.querySelectorAll(".gameboard > .water").forEach((e=>{let a=[...e.parentElement.children].indexOf(e),t=Math.floor(a/10),r=a%10;e.classList="",e.classList.add("water"),"undefined"==this.gameboard[t][r].ship&&this.gameboard[t][r].isAvailable?e.classList.add("free-water"):"undefined"!=this.gameboard[t][r].ship||this.gameboard[t][r].isAvailable?this.gameboard[t][r].isAvailable?e.classList.add("ship"):this.gameboard[t][r].isAvailable||e.classList.add("ship-hit"):e.classList.add("water-hit")})):"computer"==e&&document.querySelectorAll(".computer-board > .water").forEach((e=>{let a=[...e.parentElement.children].indexOf(e),t=Math.floor(a/10),r=a%10;e.classList="",e.classList.add("water"),this.gameboard[t][r].isAvailable?e.classList.add("free-water"):"undefined"!=this.gameboard[t][r].ship||this.gameboard[t][r].isAvailable?this.gameboard[t][r].isAvailable||e.classList.add("ship-hit"):e.classList.add("water-hit")}))}}}function r(e){return{game:e,playRandom:e=>{let a=Math.floor(10*Math.random()),t=Math.floor(10*Math.random());for(;!e.game.gameboard[a][t].isAvailable;)a=Math.floor(10*Math.random()),t=Math.floor(10*Math.random());e.game.receiveAttack(a,t),e.game.renderGameboard("user")},placeRandom(){let e,t,r=[],i=5;for(;i;){e=Math.floor(10*Math.random()),t=Math.floor(10*Math.random());let l=Math.floor(2*Math.random())?"horizontal":"vertical";for(;r.includes([e,t])||!a(this.game.gameboard,e,t,l,i);)e=Math.floor(10*Math.random()),t=Math.floor(10*Math.random());this.game.placeShip(e,t,l,i--),r.push([e,t])}this.game.renderGameboard("computer")}}}const i=r(t());i.game.startPlacement(),document.querySelector(".start").onclick=()=>{i.game.isAllPlaced&&(document.querySelector(".modal-container").style.display="none")};const l=r(t());l.game.makeAttackable(),l.placeRandom(),document.querySelectorAll(".computer-board > .water").forEach((e=>{let a=[...e.parentElement.children].indexOf(e),t=Math.floor(a/10),r=a%10;e.onclick=()=>{l.game.gameboard[t][r].isAvailable&&(l.game.receiveAttack(t,r),l.game.renderGameboard("computer"),l.game.isAllSunk()&&console.log("You win!"),l.playRandom(i),i.game.isAllSunk()&&console.log("You lost!"))}}))})();