(()=>{"use strict";function e(){let e=[...Array(10)].map((e=>Array(10)));for(let t=0;t<10;t++)for(let a=0;a<10;a++)e[t][a]={ship:"undefined",isAvailable:!0};return e}function t(e,t,a,r,i){if("vertical"==r){a+i>10&&(a=10-i);for(let r=a;r<a+i;r++){if(r+1<=9&&"undefined"!=e[t][r+1].ship)return!1;if(r-1>=0&&"undefined"!=e[t][r-1].ship)return!1;if(t-1>=0&&"undefined"!=e[t-1][r].ship)return!1;if(t+1<=9&&"undefined"!=e[t+1][r].ship)return!1}}else if("horizontal"==r){t+i>10&&(t=10-i);for(let r=t;r<t+i;r++){if(r+1<=9&&"undefined"!=e[r+1][a].ship)return!1;if(r-1>=0&&"undefined"!=e[r-1][a].ship)return!1;if(a-1>=0&&"undefined"!=e[r][a-1].ship)return!1;if(a+1<=9&&"undefined"!=e[r][a+1].ship)return!1}}return!0}function a(){return{allShips:[],gameboard:e(),totalShots:0,missed:[],isAllPlaced:!1,placeShip(e,a,r,i){if(0==i)return;if(!t(this.gameboard,e,a,r,i))return!1;let o=function(e){return{shipLength:e,hit:0,isSunk(){return this.shipLength==this.hit}}}(i);if(this.allShips.push(o),"vertical"==r){a+i>10&&(a=10-i);for(let t=a;t<a+i;t++)this.gameboard[e][t].ship=o;return!0}if("horizontal"==r){e+i>10&&(e=10-i);for(let t=e;t<e+i;t++)this.gameboard[t][a].ship=o;return!0}},receiveAttack(e,t){return!!this.gameboard[e][t].isAvailable&&("undefined"!=this.gameboard[e][t].ship?this.gameboard[e][t].ship.hit++:this.missed.includes([e,t])||this.missed.push([e,t]),this.gameboard[e][t].isAvailable=!1,this.totalShots++,!0)},isAllSunk(){for(let e=0;e<this.allShips.length;e++)if(!this.allShips[e].isSunk())return!1;return!0},startPlacement(){const e=document.querySelector(".switch > input"),t=document.querySelectorAll(".gameboard > .water"),a=document.querySelector("#length");let r=5;t.forEach((t=>{t.onclick=()=>{let i=e.checked?"horizontal":"vertical",o=[...t.parentElement.children].indexOf(t),l=Math.floor(o/10),n=o%10;this.placeShip(l,n,i,r)&&(a.innerHTML=--r+" length"),r||(document.querySelector(".place-ships > p").innerHTML="You can start playing now",this.isAllPlaced=!0),this.renderGameboard("user")}}))},makeAttackable(){document.querySelectorAll(".computer-board > .water").forEach((e=>{let t=[...e.parentElement.children].indexOf(e),a=Math.floor(t/10),r=t%10;e.onclick=()=>{this.receiveAttack(a,r)&&this.renderGameboard("computer")}}))},renderGameboard(e){"user"==e?document.querySelectorAll(".gameboard > .water").forEach((e=>{let t=[...e.parentElement.children].indexOf(e),a=Math.floor(t/10),r=t%10;e.classList="",e.classList.add("water"),"undefined"==this.gameboard[a][r].ship&&this.gameboard[a][r].isAvailable?e.classList.add("free-water"):"undefined"!=this.gameboard[a][r].ship||this.gameboard[a][r].isAvailable?this.gameboard[a][r].isAvailable?e.classList.add("ship"):this.gameboard[a][r].isAvailable||e.classList.add("ship-hit"):e.classList.add("water-hit")})):"computer"==e&&document.querySelectorAll(".computer-board > .water").forEach((e=>{let t=[...e.parentElement.children].indexOf(e),a=Math.floor(t/10),r=t%10;e.classList="",e.classList.add("water"),this.gameboard[a][r].isAvailable?e.classList.add("free-water"):"undefined"!=this.gameboard[a][r].ship||this.gameboard[a][r].isAvailable?this.gameboard[a][r].isAvailable||e.classList.add("ship-hit"):e.classList.add("water-hit")}))}}}function r(e){return{game:e,playRandom:e=>{let t=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());for(;!e.game.gameboard[t][a].isAvailable;)t=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());e.game.receiveAttack(t,a),e.game.renderGameboard("user")},placeRandom(){let e,a,r=[],i=5;for(;i;){e=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());let o=Math.floor(2*Math.random())?"horizontal":"vertical";for(;r.includes([e,a])||!t(this.game.gameboard,e,a,o,i);)e=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());this.game.placeShip(e,a,o,i--),r.push([e,a])}this.game.renderGameboard("computer")}}}const i=r(a());i.game.startPlacement(),document.querySelector(".start").onclick=()=>{i.game.isAllPlaced&&(document.querySelector(".modal-container").style.display="none")};const o=r(a());o.game.makeAttackable(),o.placeRandom();const l=document.querySelectorAll(".computer-board > .water"),n=document.querySelector(".winner-container"),s=document.querySelector(".result"),d=document.querySelector(".play-again"),h=document.querySelector(".total-shots"),c=document.querySelector(".missed-shots"),m=document.querySelector(".accuracy");d.onclick=()=>window.location.reload(),l.forEach((e=>{let t=[...e.parentElement.children].indexOf(e),a=Math.floor(t/10),r=t%10;e.onclick=()=>{o.game.gameboard[a][r].isAvailable&&(o.game.receiveAttack(a,r),o.game.renderGameboard("computer"),o.game.isAllSunk()&&(n.style.display="flex",s.innerHTML="win",s.style.color="darkgreen",h.innerHTML=i.game.totalShots,c.innerHTML=i.game.missed.length,console.log(i.game.missed),m.innerHTML=((i.game.totalShots-i.game.missed.length)/i.game.totalShots*100).toFixed(2)+"%",console.log("You win!")),o.playRandom(i),i.game.isAllSunk()&&(n.style.display="flex",s.innerHTML="lost",s.style.color="darkred",h.innerHTML=i.game.totalShots,c.innerHTML=i.game.missed.length,m.innerHTML=((i.game.totalShots-i.game.missed.length)/i.game.totalShots*100).toFixed(2)+"%",console.log("You lost!")))}}))})();